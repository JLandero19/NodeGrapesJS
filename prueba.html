<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <title>Select con buscador de íconos</title>

        <!-- Bootstrap (opcional si ya lo tienes) -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />

        <!-- Select2 -->
        <link
            href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
            rel="stylesheet"
        />
        <style>
            .select2-container .select2-selection--single {
                height: 38px;
                padding: 5px 10px;
            }

            .icon-preview {
                font-size: 40px;
                margin-top: 20px;
            }
        </style>

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        />
    </head>
    <body class="p-4">
        <div class="container">
            <h3>Selecciona un ícono</h3>

            <select id="icon-select" class="form-select" style="width: 100%">
                <option value="">Cargando íconos...</option>
            </select>

            <div id="icon-preview" class="icon-preview mt-4 text-primary"></div>
        </div>

        <!-- jQuery (requerido por Select2) -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Select2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

        <script>
            async function getFreeFontAwesomeIcons() {
                const response = await fetch(
                    "https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/metadata/icons.json"
                );
                const data = await response.json();
                const freeIcons = Object.entries(data)
                    .filter(
                        ([_, iconData]) =>
                            iconData.free && iconData.free.length > 0
                    )
                    .map(([name, iconData]) => ({
                        name,
                        style: iconData.free[0], // Usamos el primer estilo disponible (como 'solid')
                    }));

                return freeIcons;
            }

            async function setupIconSelect() {
                const iconList = await getFreeFontAwesomeIcons();
                const selectElement = document.getElementById("icon-select");
                selectElement.innerHTML = ""; // Limpiar el select

                // Agregar la opción por defecto
                const placeholderOption = document.createElement("option");
                placeholderOption.value = "";
                placeholderOption.textContent = "Selecciona un ícono";
                selectElement.appendChild(placeholderOption);

                // Rellenar el select con las opciones
                iconList.forEach((icon) => {
                    const value = `fa-${icon.style} fa-${icon.name}`;
                    const label = `${icon.name}`;
                    const option = document.createElement("option");
                    option.value = value;
                    option.textContent = label;
                    selectElement.appendChild(option);
                });

                // Inicializar Select2
                $(selectElement).select2({
                    placeholder: "Buscar ícono...",
                    allowClear: true,
                    templateResult: formatIconOption,
                    templateSelection: formatIconOption,
                });

                // Mostrar ícono al seleccionar
                selectElement.addEventListener("change", function () {
                    const selected = this.value;
                    const preview = document.getElementById("icon-preview");
                    if (!selected) {
                        preview.innerHTML = "";
                        return;
                    }
                    const [style, name] = selected.split("|");
                    preview.innerHTML = `<i class="fa-${style} fa-${name}"></i> <span class="ms-2">${name}</span>`;
                });
            }

            // Función que devuelve el ícono + nombre formateado para cada opción
            function formatIconOption(option) {
                if (!option.id) return option.text; // Placeholder
                const [style, name] = option.id.split(" ");
                const span = document.createElement("span");
                const icon = document.createElement("i");
                icon.className = `${style} ${name} mx-2`;
                span.appendChild(icon);
                span.appendChild(document.createTextNode(`${style} ${name}`));
                return span;
            }

            // Iniciar
            setupIconSelect();
        </script>
    </body>
</html>
